# A soundwave object. Largely customizable.
#  Intended to be spawned via noisy objects.
# All times are in seconds.

{
id: "sound_wave",
zorder: 50,
always_active: true,
editor_info: { category: "effects" },

properties: {
	init_scale:  { type: 'decimal', default: 0.10 },
	delta_scale: { type: 'decimal', default: 0.03 },
	delta_rotate:{ type: 'decimal', default: 5.0  },
	
	lifetime:    { type: 'decimal', default: 4.0 },
	time_to_live:"lifetime - cycle/50.0",
	inner_lag:   { type: 'decimal', default: 0.5 },
	
	rbg: { type: '[int]', default: [255,255,255] },
},

//on_process: "set(custom_draw, [0.0,1.0,2.0,3.0,[size,size],[-size,size],[-size,-size],[size,-size]])",

on_create: "[
	set(scale, init_scale),
	set(red,  rbg[0]),
	set(blue, rbg[1]),
	set(green,rbg[2]),
	
/*	if(rbg != [0,0,0],
		schedule(inner_lag*50.0,
			spawn('sound_wave', me.midpoint_x, midpoint_y, {
				init_scale:  me.init_scale,
				delta_scale: me.delta_scale*1.1,
				delta_rotate:me.delta_rotate,
				lifetime: me.lifetime - me.inner_lag,
				rbg: [0,0,0],
				zorder: me.zorder+1
			})
		)
	, set(zorder, zorder+1d10)) // else portion of the if statement*/
]",
	
on_process: "[
	add(scale, delta_scale),
	add(rotate, delta_rotate),
		// Black is a special color used for inner circles,
		//  So don't fade.
	if(rbg != [0,0,0], set(alpha, 200*time_to_live/lifetime), set(alpha, 150*time_to_live/lifetime + 100)),
	//set(alpha, 255*time_to_live/lifetime),
	/*set(alpha, init_fade*time_to_live/lifetime)
		where init_fade = if(rbg != [0,0,0], 255, 200), */
	
	if(time_to_live < 0, die())
]",

animation: [
	{
		id: "normal",
		image: "circle.png",
		rect: [0,0,511,511],
		frames: 1
	}
]
}
